## 3.Domain Model

### A. DDD의 4계층

- UI /Presentation Layer 
 사용자의 요청을 처리하고 사용자에게 정보를 보여주는 계층으로 사용자는 소프트웨어를 사용하는 사람 뿐만 아니라 외부 시스템일 수 있다.

- Application Layer 
 : 소프트웨어가 비즈니스 로직을 정의하고 정상적으로 수행될 수 있도록 도메인 계층과 인프라스트럭쳐 계층을 연결해주는 역할을 하는 계층으로 이 계층은 많은 정보를 가지고 있지 않게 유지해야한다. 실질적인 데이터의 상태 변화 등의 처리는 도메인 계층에서 진행할 수 있도록 위임하는것이 중요하다. 응용 계층에서 진행하는 일은 일반적으로 transaction 관리, DTO 변환, 그리고 모듈간의 연계 이렇게 3가지를 들 수 있다. (작업의 순서 조정 등)

- Domain Layer 
: 비즈니스 규칙, 정보에 대한 실질적인 도메인에 대한 정보를 가지고 있으며 이 모든것을 책임지는 계층이다. 이 계층에서는 업무 상황을 반영하여 상태를 제어하는 역할에 집중하는 계층이다. 이 계층이 업무용 소프트웨어의 핵심이다.

- Infrastructure Layer 
: 상위 계층을 지원하는 일반화된 기술적 기능을 제공하는 계층입니다. 일반적으로 외부 시스템을 호출한다거나 하는 역할을 담당한다. 해당 계층에서 얻어온 정보를 응용계층 또는 도메인 계층에 전달하는 것을 주 역할로 담당. ex) 데이터베이스, 메시징 시스템 등 과의 연동

### B. Domain Model 이란

Domain Model은 일반적인 객체. 무엇보다 “행위(behavior)”가 중요하다. Unit Testing하기 적합한 존재이며 행동과 데이터를 모두 통합하는 도메인의 객체 모델입니다.

1) 행위 없이 코딩 (내가 너를 다 파악해서 조작하겠다 = 협력이 아님 = 복잡성이 감소하지 않음 = application layer) 
Long amount = account.getAmount();
account.setAmount(amount + 10_000);

2) 행위가 있다면? (내가 알게 뭐야 = 알아서 해 = 위임)
account.increateAmount(10_000);

### C. Repository 
: 도메인 object를 관리(도메인모델중심)
Repository는 객체의 컬렉션으로 객체의 상태를 관리하는 저장소이다. 즉, Repository의 구현이 파일시스템으로 되든, 아니면 HashMap으로 구현됐든지 상관없다. 그냥 객체(entity)에 대한 CRUD를 수행할 수 있으면 된다.

DAO가 데이터를 관리한다면, Repository는 도메인 모델을 관리한다. 거칠게 말하면, 전자는 DB 중심이고, 후자는 도메인 모델 중심이다.
예전 기술을 활용하는 조직이라면 ERD를 먼저 그리고 나서 DAO와 VO(DTO)를 사용하는 방식으로 개발을 진행할 거고(데이터베이스 주도 개발), DDD를 극단적으로 따르는 조직이라면 도메인 모델을 먼저 만들고, JPA Entity를 따로 만들어서 도메인 모델과 매핑한다. 전자는 DB가 바뀌면 프로그램이 바뀌고, 후자는 프로그램을 지원하기 위해 DB를 조정한다. 후자는 CRQS, Event Sourcing 등을 도입하거나 솔루션 자체를 변경하기 (어디까지나 **상대적으로**) 쉽다.

### D. VO(Value Object) 
:도메인에서 한 개 또는 그 이상의 속성들을 묶어서 특정 값을 나타내는 객체를 의미한다. 
VO는 도메인 객체의 일종이고 보통 기본 키로 식별 값을 갖는 Entity와 구별해서 사용한다.
1) equals & hash code 메서드를 재정의해야 한다.
2) 수정자(setter)가 없는 불변 객체여야 한다.
VO의 장점, VO를 통해 도메인을 설계한다면, 객체가 생성될 때 해당 객체안에 제약사항을 추가할 수 있다.
또한 생성될 인스턴스가 정해져 있는 경우에는 미리 인스턴스를 생성해놓고 캐싱하여 성능을 높이는 방법도 고려해볼 수 있다. 
그뿐만 아니라, Entity의 원시 값들을 VO로 포장하면 Entity가 지나치게 거대해지는 것을 막을 수 있어서, 테이블 관점이 아닌 객체 지향적인 관점으로 프로그래밍할 수 있다.