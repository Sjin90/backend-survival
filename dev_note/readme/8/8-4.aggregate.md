# 8-4.Aggregate

1.  **집합체 (Aggregate)**

    Aggregate는 불변식(Invariant)을 유지하고 여러 도메인 객체를 사용하기 좋게 만들어 준다. 사방에서 개별 객체에 침범함으로써 불변식(무결성)을 깨뜨리고 일관성을 파괴하는 일이 없도록 지켜주면서 우리가 다뤄야 할 도메인 객체의 개수를 적절하게 조절해 준다.  일관성을 관리하기 떄문에 복잡한 도메인 구조를 단순한 구조로 만들어준다.
2.  **Aggregate을 사용하면 좋은 점**

    1. 불변식을 지킬 수 있다.
    2. 적절한 인터페이스를 통해 더 나은 표현력도 가질 수 있게 된다.
    3.  OOP에서 말하는 협력하는 객체를 더 잘 구성할 수 있게 된다.&#x20;

        책임, 위임, 관심사의 분리 등의 주제를 이를 통해 고민하고 적용할 수 있다.


3. **IDDD의 저자인 Vaughn Vernon은 4가지 경험 법칙:**
   1. 불변식을 통해 일관성 경계를 찾아서 모델링한다. Aggregate은 트랜잭션적 일관성 경계와 동의어다.
   2. 작은 Aggregate으로 설계한다.
   3. ID로 다른 Aggregate을 참조한다. JPA 등을 사용하면 관련된 객체를 모두 직접 참조할 수 있게 되는데, 그렇게 하지 않는다.
   4. 경계 밖에선 결과적 일관성을 사용한다. 이를 위해 도메인 이벤트 등을 사용할 수 있다
4. **불변식** : 지켜야 할 제약 조건, 규칙
5.  **트랜잭션적 일관성과 결과적 일관성**

    트랜잭션적 일관성 : 하나의 Aggregate만 수정해야한다. 각 Aggregate은 일관성 있는 트랜잭션 경계를 형성하고 트랜잭션 제어가 데이터베이스에 의해 Commit될 때, 한 Aggregate 내의 모든 구성요소들은 비즈니스 규칙을 따르면서 일관성 있게 처리된다는 것이다.

    결과적 일관성 : 결과적으로도 데이터가 일관적으로 관리되어야한다.

