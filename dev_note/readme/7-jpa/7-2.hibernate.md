# 7-2.Hibernate

1.  **Hibernate**&#x20;

    대표적인JPA의 구현체로이다. JPA 인터페이스를 구현하며, 내부적으로 JDBC API를 사용함.

    JPA는 관계형 데이터베이스와 객체의 `패러다임 불일치 문제를 해결`할 수 있다는 점과 `영속성 컨텍스트(엔티티를 영구 저정하는 환경)` 제공이 큰 특징이에요. SQL 중심이 아닌 객체 중심의 개발이 가능하다.

    1.  장점

        SQL 반복 작업을 하지 않으므로 생산성이 높아지고 테이블 변경 사항이 있는 경우 자동으로 JPA가 처리해주는 부분이 있어 유지보수가 쉽다. 또한 특정  벤더에 종속적이지 않고 패러다임의 불일치(객체모델과 관계형모델간의 불일치)를 해결하는데 도움을 준다.&#x20;
    2.  단점

        성능적으로 아쉬울 수 있고, 메서드호출로 DB데이터를 조작하기 때문에 세밀함이 떨어진다. (JPQL등을 제공 하긴함)
2.  **데이터 모델 / 객체 모델**

    (The Object-Relational Impedance Mismatch)

    객체 모델을 관계형 모델에 저장할 때 발생하는 문제, 즉 패러다임의 불일치에서 오는 문제를 말한다. 이 문제를 해결하는 게 ORM의 과제이다.

    #### 객체 모델 & 관계형 모델

    RDBMS는 데이터를 테이블 형식으로 표현한다. 반면 자바 같은 객체 지향 모델은 객체 그래프로 데이터를 표현한다. 따라서 객체를 테이블 형식으로 저장하면 다섯 가지 불일치 문제가 발생한다.

    * 세분성(Granularity) :데이터베이스의 테이블 수보다 더 많은 클래스가 있는 객체 모델이 있을 수 있다. 객체 모델이 관계형 모델보다 더 세분화되어 있기 때문이다.
    * 상속(Subtypes) :RDBMS에는 상속이란 개념이 없다. 하위 타입을 지원하긴 하지만 표준화되어 있지 않다.&#x20;
    * 동일성(Identity) : RDBMS는 정확히 하나의 동일성을 보장하는 개념인 기본 키(Primary Key,PK)를 제공한다. 하지만 (Java)객체는 동일성(==) 뿐만 아니라 동등성(equals())을 모두 정의한다.
    * 연관성(Associations) : 객체지향 언어에서 연관관계는 단방향 참조로만 이루어진다. RDBMS는 외래 키(Foreign key, FK) 하나를 사용해서 양방향 참조를 가진다. 하지만 객체 모델은 단방향 참조가 기본이고 양방향을 참조하려면 양쪽에 연관을 두 번 정의해야 한다.
    * 데이터 탐색(Data navigation) : Java에서 데이터에 접근할 때 하나의 객체에서 출발해 다른 연결로 이어지는 객체 그래프 탐색 방식을 사용한다. 하지만 이 방식은 관계형 데이터베이스에서 이 방식은 비효율적이다. RDBMS는 SQL쿼리를 최소화하기 위해 JOIN을 통해 여러 엔티티를 불러와서 데이터를 탐색한다.
3.  **entityManager**

    엔티티를 관리하는 역할을 수행하는 클래스로 영속성컨텍스트를 통해 데이터의 상태 변화를 감지하고 필요한 쿼리를 자동으로 수행한다.

    가급적 쓰레드 간에 공유해서는 안되고(동시성 문제), 사용하고 나면 바로 버려야 함

    **entityManagerFactory**&#x20;

    entityManager를 만들어주고 entityManagerFactory는하나만 생성해서 애플리케이션 전체에서 공유해야 함
4.  **트랜잭션(Transaction)**

    하나의 작업 단위로 DB관련 CUD 작업시, 트랜잭션의 단위로 COMMIT,ROLLBACK을 진행함

    예를 들어, A 테이블에 N건의 INSERT를 진행하다가 오류가 나는 경우, 오류 난 건수 이전의 같은 트랜잭션에서 INSERT처리한 건들이 모두 ROLLBACK진행된다.


5.  **JPQL**

    JPQL은 SQL과 비슷한 문법을 가진 객체 지향 쿼리이다. 조금이라도 복잡한 검색을 수행할 수가 없어서 JPQL을 사용한다.

    1.  JPQL 특징

        1\) 테이블이 아닌 객체를 검색하는 객체지향 쿼리

        2\) SQL을 추상화했기 때문에 특정 벤더에 종속적이지 않음

        3\) JPA는 JPQL을 분석하여 SQL을 생성한 후 DB에서 조회
    2.  JPQL 기본문법

        1\)  대소문자 구분 : 엔티티 이름이나 속성의 경우 대소문자 구분한다.

        2\) 엔티티이름 : from뒤의 나오는 이름은 엔티티의 이름이다.

        3\) 별칭 : JPQL은 엔티티의 별칭을 필수적으로 명시해야한다.

    ```java
    //JPQL예시
    String jpql = "select p from People p ";
    String jpql = "select b from Board b where b.title LIKE CONCAT('%',:kwd,'%') ";
    ```

